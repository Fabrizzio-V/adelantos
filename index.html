// Busca y reemplaza estas funciones en tu código HTML

// Función editAdvance corregida
function editAdvance(id) {
    console.log('Editando adelanto con ID:', id, 'Tipo:', typeof id);
    
    const advance = advances.find(a => {
        // Comparar como string y número para mayor compatibilidad
        return String(a.id) === String(id) || Number(a.id) === Number(id);
    });
    
    console.log('Adelanto encontrado:', advance);
    
    if (advance) {
        editingId = String(id); // Asegurar que se guarde como string
        document.getElementById('editDate').value = advance.date;
        document.getElementById('editEmployeeName').value = advance.employeeName;
        document.getElementById('editAmount').value = advance.amount;
        document.getElementById('editNotes').value = advance.notes || '';
        document.getElementById('editModal').style.display = 'flex';
    } else {
        alert('No se pudo encontrar el adelanto para editar');
    }
}

// Función updateAdvance corregida
async function updateAdvance() {
    console.log('Actualizando adelanto con ID:', editingId);
    
    const advance = {
        id: String(editingId), // Asegurar que se envíe como string
        date: document.getElementById('editDate').value,
        employeeName: document.getElementById('editEmployeeName').value,
        amount: parseInt(document.getElementById('editAmount').value),
        notes: document.getElementById('editNotes').value,
        modifiedBy: currentUser,
        modifiedAt: new Date().toISOString()
    };

    console.log('Datos a enviar:', advance);

    // Mantener información original
    const originalAdvance = advances.find(a => 
        String(a.id) === String(editingId) || Number(a.id) === Number(editingId)
    );
    
    if (originalAdvance) {
        advance.registeredBy = originalAdvance.registeredBy;
        advance.registeredAt = originalAdvance.registeredAt;
    }

    const result = await saveToSheets('update', advance);
    
    if (result && result.status === 'success') {
        // Recargar datos desde Google Sheets
        await loadData();
        closeModal();
        showNotification(`Adelanto actualizado por ${currentUser}`);
    } else if (result && result.status === 'error') {
        alert('Error al actualizar: ' + (result.message || 'Error desconocido'));
    }
}

// Función deleteAdvance corregida
async function deleteAdvance(id) {
    if (!confirm('¿Está seguro de eliminar este adelanto?')) return;
    
    console.log('Eliminando adelanto con ID:', id);
    
    const result = await saveToSheets('delete', { 
        id: String(id), // Asegurar que se envíe como string
        deletedBy: currentUser 
    });
    
    if (result && result.status === 'success') {
        // Recargar datos desde Google Sheets
        await loadData();
        showNotification('Adelanto eliminado');
    } else if (result && result.status === 'error') {
        alert('Error al eliminar: ' + (result.message || 'Error desconocido'));
    }
}
